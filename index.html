<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì½”ì¸ ë§¤ì… ì‹ ì²­</title>
  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      margin: 0;
      padding: 20px;
      animation: fadeIn 1s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      padding: 40px;
      animation: slideUp 0.8s ease-in-out;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h2 {
      text-align: center;
      color: #008080;
      margin-bottom: 30px;
      font-size: 24px;
    }
    .form-group {
      margin-bottom: 20px;
      transition: transform 0.2s;
    }
    .form-group:hover {
      transform: scale(1.02);
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #00695c;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #00bfa5;
      box-shadow: 0 0 8px rgba(0,191,165,0.5);
      outline: none;
    }
    .submit-btn {
      margin-top: 30px;
      padding: 16px;
      width: 100%;
      background: linear-gradient(90deg, #00796b, #00bfa5);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s;
    }
    .submit-btn:hover {
      background: linear-gradient(90deg, #004d40, #00897b);
      transform: translateY(-2px) scale(1.02);
    }
    .checkbox-label {
      font-size: 14px;
      display: flex;
      align-items: center;
      margin-top: 20px;
      color: #444;
    }
    .checkbox-label input {
      margin-right: 8px;
      width: auto;
    }
    .animated-icon {
      display: inline-block;
      margin-right: 8px;
      animation: rotateIcon 2s linear infinite;
    }
    @keyframes rotateIcon {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .lang-select {
      position: absolute;
      right: 30px;
      top: 30px;
      z-index: 10;
      background: #e0f7fa;
      border-radius: 8px;
      border: none;
      padding: 6px 12px;
      font-size: 15px;
      color: #008080;
      font-weight: 600;
      cursor: pointer;
    }
    .star-btn {
      background: none;
      border: none;
      color: #fbc02d;
      font-size: 1.3em;
      cursor: pointer;
      margin-left: 4px;
      vertical-align: middle;
    }
    .calendar-section {
      margin: 30px 0 0 0;
      background: #f5f7fa;
      border-radius: 16px;
      padding: 24px 18px;
    }
    .account-box {
      background: #e0f7fa;
      border-radius: 12px;
      padding: 16px 12px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .account-box .qrcode {
      margin-left: auto;
    }
    .account-copy-btn {
      background: #00bfa5;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px 14px;
      font-size: 14px;
      cursor: pointer;
      margin-left: 8px;
    }
    .fee-info {
      color: #d84315;
      font-size: 14px;
      margin-top: 6px;
    }
    .toast {
      position: fixed;
      left: 50%;
      bottom: 40px;
      transform: translateX(-50%);
      background: #222;
      color: #fff;
      padding: 14px 28px;
      border-radius: 24px;
      font-size: 16px;
      z-index: 9999;
      opacity: 0.95;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      display: none;
    }
    .focus-outline:focus {
      outline: 2px solid #1976d2 !important;
      outline-offset: 2px;
    }
    @media (max-width: 600px) {
      body { padding: 4px; }
      .container { padding: 12px 2vw; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
      h2 { font-size: 1.1rem; margin-bottom: 18px; }
      .form-group { margin-bottom: 12px; }
      label { font-size: 14px; margin-bottom: 4px; }
      input, select, textarea { font-size: 15px; padding: 9px; border-radius: 7px; }
      .submit-btn { font-size: 15px; padding: 12px; border-radius: 8px; margin-top: 18px; }
      .checkbox-label { font-size: 12px; margin-top: 12px; }
      #recent-apply, #live-apply-list { font-size: 14px; padding: 0 2px; }
      #lookup-section { padding: 12px 4px; border-radius: 10px; }
      #lookup-section input, #lookup-section button { font-size: 14px; padding: 8px; border-radius: 7px; }
      #lookup-section h3 { font-size: 1rem; margin-bottom: 10px; }
      #toggle-dark { width: 38px; height: 38px; font-size: 1rem; right: 10px; bottom: 10px; }
      .animated-icon { font-size: 1.1rem; }
      .calendar-section { padding: 10px 2px; }
    }
  </style>
</head>
<body>
  <select class="lang-select" id="lang-select" aria-label="ì–¸ì–´ ì„ íƒ">
    <option value="ko">í•œêµ­ì–´</option>
    <option value="en">English</option>
    <option value="zh">ä¸­æ–‡</option>
  </select>
  <div class="container">
    <h2>
      <span class="animated-icon">ğŸ’±</span>
      <span data-i18n="title">ì½”ì¸ ë§¤ì… ì‹ ì²­ì„œ</span>
    </h2>
    <div class="account-box" tabindex="0" aria-label="ì…ê¸ˆ ê³„ì¢Œ ì •ë³´">
      <span data-i18n="account_info">ì…ê¸ˆ ê³„ì¢Œ: êµ­ë¯¼ì€í–‰ 123456-78-901234 (ì˜ˆê¸ˆì£¼: í™ê¸¸ë™)</span>
      <button class="account-copy-btn focus-outline" id="copy-account" aria-label="ê³„ì¢Œ ë³µì‚¬">ë³µì‚¬</button>
      <div class="qrcode" id="qrcode"></div>
    </div>
    <div class="form-group">
      <label for="depositor" data-i18n="depositor">ì…ê¸ˆìëª…</label>
      <input id="depositor" type="text" placeholder="ì…ê¸ˆìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" class="focus-outline" aria-label="ì…ê¸ˆìëª…" />
      <button class="star-btn" id="star-depositor" title="ì¦ê²¨ì°¾ê¸°">â˜†</button>
    </div>
    <div class="form-group">
      <label for="email" data-i18n="email">ì´ë©”ì¼(ì„ íƒ)</label>
      <input id="email" type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ì‹ ì²­ ë‚´ì—­ ë°œì†¡)" autocomplete="off" class="focus-outline" aria-label="ì´ë©”ì¼" />
    </div>
    <div class="form-group">
      <label for="amount" data-i18n="amount">ì…ê¸ˆ ê¸ˆì•¡ (KRW)</label>
      <input id="amount" type="number" placeholder="ì…ê¸ˆ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”" class="focus-outline" aria-label="ì…ê¸ˆ ê¸ˆì•¡" />
      <div id="converted-amount" style="margin-top:6px; color:#1976d2; font-size:15px; font-weight:500;"></div>
    </div>
    <div class="form-group">
      <label for="coin-type" data-i18n="coin_type">ë°›ì„ ì½”ì¸ ì¢…ë¥˜</label>
      <select id="coin-type" class="focus-outline" aria-label="ì½”ì¸ ì¢…ë¥˜">
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="USDT">USDT</option>
        <option value="BTC">BTC</option>
        <option value="ETH">ETH</option>
      </select>
    </div>
    <div id="exchange-rate-info" style="margin-bottom:8px; color:#008080; font-weight:bold;"></div>
    <div class="fee-info" id="fee-info"></div>
    <div class="form-group">
      <label for="network" data-i18n="network">ë„¤íŠ¸ì›Œí¬ ì„ íƒ</label>
      <select id="network" class="focus-outline" aria-label="ë„¤íŠ¸ì›Œí¬">
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="TRC20">TRC20 (íŠ¸ë¡  ê¸°ë°˜)</option>
        <option value="ERC20">ERC20 (ì´ë”ë¦¬ì›€ ê¸°ë°˜)</option>
        <option value="BEP20">BEP20 (ë°”ì´ë‚¸ìŠ¤ ìŠ¤ë§ˆíŠ¸ì²´ì¸)</option>
      </select>
    </div>
    <div class="form-group">
      <label for="wallet" data-i18n="wallet">ì½”ì¸ ì§€ê°‘ ì£¼ì†Œ</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="wallet" type="text" placeholder="ì½”ì¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex:1;" class="focus-outline" aria-label="ì§€ê°‘ ì£¼ì†Œ" />
        <button type="button" id="copy-wallet" style="padding:8px 12px; font-size:14px; border-radius:8px; border:none; background:#e0f7fa; color:#008080; cursor:pointer;" aria-label="ì§€ê°‘ì£¼ì†Œ ë³µì‚¬">ë³µì‚¬</button>
        <button class="star-btn" id="star-wallet" title="ì¦ê²¨ì°¾ê¸°">â˜†</button>
      </div>
    </div>
    <div class="form-group">
      <label for="memo" data-i18n="memo">ë©”ëª¨/ë¹„ê³  (ì„ íƒ)</label>
      <textarea id="memo" rows="2" placeholder="ì „ë‹¬ì‚¬í•­ì´ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”" class="focus-outline" aria-label="ë©”ëª¨"></textarea>
    </div>
    <div class="form-group">
      <label for="phone">íœ´ëŒ€í° ë²ˆí˜¸</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="phone" type="tel" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥ ('-' ì—†ì´)" maxlength="11" class="focus-outline" aria-label="íœ´ëŒ€í° ë²ˆí˜¸" style="flex:1;" />
        <button type="button" id="sms-send" style="padding:8px 12px; font-size:14px; border-radius:8px; border:none; background:#e0f7fa; color:#008080; cursor:pointer;">ì¸ì¦ìš”ì²­</button>
      </div>
    </div>
    <div class="form-group" id="sms-code-group" style="display:none;">
      <label for="sms-code">ì¸ì¦ë²ˆí˜¸</label>
      <input id="sms-code" type="text" maxlength="6" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥" class="focus-outline" aria-label="ì¸ì¦ë²ˆí˜¸" />
      <button type="button" id="sms-verify" style="margin-top:6px; padding:8px 12px; font-size:14px; border-radius:8px; border:none; background:#e0f7fa; color:#008080; cursor:pointer;">ì¸ì¦í™•ì¸</button>
      <span id="sms-status" style="margin-left:10px; color:#388e3c;"></span>
    </div>
    <div class="form-group">
      <label for="file">ì˜ìˆ˜ì¦/ì²¨ë¶€íŒŒì¼ (ì„ íƒ)</label>
      <input id="file" type="file" accept="image/*" class="focus-outline" aria-label="ì˜ìˆ˜ì¦ ì²¨ë¶€" />
      <img id="file-preview" style="display:none; margin-top:8px; max-width:180px; border-radius:8px;" />
    </div>
    <button class="submit-btn focus-outline" aria-label="ì½”ì¸ ë§¤ì… ì‹ ì²­ ì™„ë£Œ"><span data-i18n="submit">ğŸš€ ì½”ì¸ ë§¤ì… ì‹ ì²­ ì™„ë£Œ</span></button>
    <label class="checkbox-label">
      <input type="checkbox" checked aria-label="ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë™ì˜" />
      <span data-i18n="privacy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë™ì˜ (ë‚´ìš©ë³´ê¸°)</span>
    </label>
    <div id="recent-apply" style="margin-top:32px;"></div>
    <div id="live-apply-list" style="margin-top:36px;"></div>
    <hr style="margin:40px 0 24px 0; border:0; border-top:1px solid #e0e0e0;">
    <div id="lookup-section" style="background:#f5f7fa; border-radius:16px; padding:24px 18px; max-width:480px; margin:0 auto 32px auto;">
      <h3 style="color:#008080; margin-bottom:16px;" data-i18n="lookup_title">ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ</h3>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;">
        <input id="lookup-depositor" placeholder="ì…ê¸ˆìëª…" style="flex:1; padding:10px; border-radius:8px; border:1px solid #bbb; font-size:15px;" class="focus-outline" aria-label="ì¡°íšŒ ì…ê¸ˆìëª…" />
        <input id="lookup-wallet" placeholder="ì§€ê°‘ì£¼ì†Œ" style="flex:2; padding:10px; border-radius:8px; border:1px solid #bbb; font-size:15px;" class="focus-outline" aria-label="ì¡°íšŒ ì§€ê°‘ì£¼ì†Œ" />
        <button id="lookup-btn" style="padding:10px 18px; border-radius:8px; background:#00bfa5; color:#fff; font-weight:700; border:none; cursor:pointer;" class="focus-outline" aria-label="ì¡°íšŒ">ì¡°íšŒ</button>
      </div>
      <div id="lookup-result"></div>
      <button id="download-csv" style="margin-top:10px; padding:8px 16px; border-radius:8px; background:#1976d2; color:#fff; border:none; font-size:14px; cursor:pointer;">CSV ë‹¤ìš´ë¡œë“œ</button>
      <button id="download-xlsx" style="margin-top:10px; margin-left:8px; padding:8px 16px; border-radius:8px; background:#388e3c; color:#fff; border:none; font-size:14px; cursor:pointer;">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
    </div>
    <div class="calendar-section">
      <h3 style="color:#008080; margin-bottom:12px;" data-i18n="calendar_title">ì‹ ì²­ ë‚´ì—­ ìº˜ë¦°ë”</h3>
      <div id="calendar"></div>
    </div>
    <div id="stats-section" style="margin:40px 0 0 0; background:#f5f7fa; border-radius:16px; padding:24px 18px;">
      <h3 style="color:#008080; margin-bottom:12px;">í†µê³„/ë­í‚¹</h3>
      <div style="display:flex; flex-wrap:wrap; gap:24px;">
        <div style="flex:1; min-width:220px;">
          <canvas id="chart-day" height="120"></canvas>
        </div>
        <div style="flex:1; min-width:220px;">
          <canvas id="chart-coin" height="120"></canvas>
        </div>
        <div style="flex:1; min-width:220px;">
          <div id="ranking-list"></div>
        </div>
      </div>
    </div>
    <div id="filter-section" style="margin:32px 0 0 0; background:#f5f7fa; border-radius:16px; padding:18px 14px;">
      <h3 style="color:#008080; margin-bottom:10px;">ê³ ê¸‰ í•„í„°</h3>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <input id="filter-min-amount" type="number" placeholder="ìµœì†Œê¸ˆì•¡" style="flex:1;" />
        <input id="filter-max-amount" type="number" placeholder="ìµœëŒ€ê¸ˆì•¡" style="flex:1;" />
        <input id="filter-from" type="date" style="flex:1;" />
        <input id="filter-to" type="date" style="flex:1;" />
        <select id="filter-status" style="flex:1;">
          <option value="">ìƒíƒœ ì „ì²´</option>
          <option value="ì‹ ì²­">ì‹ ì²­</option>
          <option value="ì™„ë£Œ">ì™„ë£Œ</option>
          <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
        </select>
        <select id="filter-coin" style="flex:1;">
          <option value="">ì½”ì¸ ì „ì²´</option>
          <option value="USDT">USDT</option>
          <option value="BTC">BTC</option>
          <option value="ETH">ETH</option>
        </select>
        <button id="filter-btn" style="padding:8px 16px; border-radius:8px; background:#1976d2; color:#fff; border:none; font-size:14px; cursor:pointer;">í•„í„° ì ìš©</button>
      </div>
    </div>
    <div id="admin-section" style="margin:32px 0 0 0; background:#f5f7fa; border-radius:16px; padding:18px 14px;">
      <h3 style="color:#008080; margin-bottom:10px;">ê´€ë¦¬ì ì¸ì¦</h3>
      <input id="admin-token" type="text" placeholder="ê´€ë¦¬ì í† í° ì…ë ¥" style="width:60%; padding:8px; border-radius:8px; border:1px solid #bbb; font-size:15px;" />
      <button id="admin-login" style="padding:8px 16px; border-radius:8px; background:#388e3c; color:#fff; border:none; font-size:14px; cursor:pointer;">ë¡œê·¸ì¸</button>
      <span id="admin-status" style="margin-left:10px; color:#388e3c;"></span>
    </div>
    <button id="toggle-dark" style="position:fixed; right:24px; bottom:24px; z-index:100; background:#222; color:#fff; border:none; border-radius:50%; width:48px; height:48px; font-size:1.3rem; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.12);">ğŸŒ™</button>
    <div class="toast" id="toast"></div>
  </div>
  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/i18next@21.6.16/dist/umd/i18next.min.js"></script>
  <script>
    // -------------------- ìƒíƒœ ë³€ìˆ˜ --------------------
    let lastRate = null;
    const depositorInput = document.getElementById('depositor');
    const amountInput = document.getElementById('amount');
    const coinTypeInput = document.getElementById('coin-type');
    const networkInput = document.getElementById('network');
    const walletInput = document.getElementById('wallet');

    // -------------------- í•¨ìˆ˜ ì •ì˜ --------------------
    function getDepositorList() {
      return JSON.parse(localStorage.getItem('depositors') || '[]');
    }
    function saveDepositor(name) {
      let list = getDepositorList();
      if (!list.includes(name)) {
        list.push(name);
        localStorage.setItem('depositors', JSON.stringify(list));
      }
    }
    function saveTemp() {
      localStorage.setItem('apply-temp', JSON.stringify({
        depositor: depositorInput.value,
        amount: amountInput.value,
        coinType: coinTypeInput.value,
        network: networkInput.value,
        wallet: walletInput.value
      }));
    }
    function loadTemp() {
      const temp = JSON.parse(localStorage.getItem('apply-temp') || '{}');
      if (temp.depositor) depositorInput.value = temp.depositor;
      if (temp.amount) amountInput.value = temp.amount;
      if (temp.coinType) coinTypeInput.value = temp.coinType;
      if (temp.network) networkInput.value = temp.network;
      if (temp.wallet) walletInput.value = temp.wallet;
      updateExchangeRate();
      updateConvertedAmount();
    }
    function isWalletValid(addr) {
      return addr && addr.length >= 10 && !/\s/.test(addr);
    }
    function showRecentApply(data) {
      const div = document.getElementById('recent-apply');
      if (!data) { div.innerHTML = ''; return; }
      div.innerHTML = `<div style="background:#e0f7fa;padding:18px 16px;border-radius:12px;margin-top:12px;">
        <b>ìµœê·¼ ì‹ ì²­ ë‚´ì—­</b><br>
        ì…ê¸ˆìëª…: ${data.depositor}<br>
        ê¸ˆì•¡: ${parseFloat(data.amount).toLocaleString()} KRW<br>
        ì½”ì¸: ${data.coinType}<br>
        ë„¤íŠ¸ì›Œí¬: ${data.network}<br>
        ì§€ê°‘ì£¼ì†Œ: ${data.wallet}
      </div>`;
    }
    async function updateExchangeRate() {
      const coin = coinTypeInput.value;
      const infoDiv = document.getElementById('exchange-rate-info');
      if (!coin) {
        infoDiv.textContent = '';
        lastRate = null;
        updateConvertedAmount();
        return;
      }
      infoDiv.textContent = 'í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      try {
        const res = await fetch(`https://api.exchangerate.host/convert?from=KRW&to=${coin}`);
        const data = await res.json();
        if (data.success && data.info && data.result) {
          infoDiv.textContent = `1 ${coin} â‰ˆ ${(1/data.result).toLocaleString(undefined, {maximumFractionDigits: 2})} KRW`;
          lastRate = data.result;
        } else {
          infoDiv.textContent = 'í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          lastRate = null;
        }
      } catch {
        infoDiv.textContent = 'í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        lastRate = null;
      }
      updateConvertedAmount();
    }
    function updateConvertedAmount() {
      const amount = parseFloat(amountInput.value);
      const coin = coinTypeInput.value;
      const div = document.getElementById('converted-amount');
      if (!lastRate || !amount || !coin) {
        div.textContent = '';
        return;
      }
      const coinAmount = amount / lastRate;
      div.textContent = `${amount.toLocaleString()} KRW â‰ˆ ${coinAmount.toLocaleString(undefined, {maximumFractionDigits: 6})} ${coin}`;
    }
    async function fetchLiveApplyList() {
      try {
        const res = await fetch('http://localhost:3000/api/apply');
        const data = await res.json();
        const recent = data.sort((a,b)=>b.createdAt.localeCompare(a.createdAt)).slice(0,7);
        document.getElementById('live-apply-list').innerHTML =
          `<div style="background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06); padding:14px 10px;">
            <b style="color:#008080;">ì‹¤ì‹œê°„ ìµœê·¼ ì‹ ì²­ ë‚´ì—­</b>
            <ul style="margin:10px 0 0 0; padding:0; list-style:none;">
              ${recent.map(x=>`<li style="margin-bottom:6px;">
                <span style="color:#1976d2; font-weight:600;">${x.depositor}</span> 
                <span style="color:#888;">${parseFloat(x.amount).toLocaleString()} KRW</span> 
                <span style="color:#008080;">${x.coinType}</span>
                <span style="color:#aaa; font-size:13px;">(${new Date(x.createdAt).toLocaleTimeString()})</span>
              </li>`).join('')}
            </ul>
          </div>`;
      } catch {}
    }

    // -------------------- ì´ë²¤íŠ¸ ë°”ì¸ë”© --------------------
    document.querySelector('.submit-btn').addEventListener('click', async function(e) {
      e.preventDefault();
      const depositor = depositorInput.value.trim();
      const amount = amountInput.value.trim();
      const coinType = coinTypeInput.value;
      const network = networkInput.value;
      const wallet = walletInput.value.trim();
      if (!depositor || !amount || !coinType || !network || !wallet) {
        alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }
      if (!isWalletValid(wallet)) {
        alert('ì½”ì¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        walletInput.focus();
        return;
      }
      try {
        const res = await fetch('http://localhost:3000/api/apply', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ depositor, amount, coinType, network, wallet })
        });
        const data = await res.json();
        if (data.success) {
          alert('ì‹ ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
          saveDepositor(depositor);
          showRecentApply({depositor, amount, coinType, network, wallet});
          depositorInput.value = '';
          amountInput.value = '';
          coinTypeInput.value = '';
          networkInput.value = '';
          walletInput.value = '';
          localStorage.removeItem('apply-temp');
          updateExchangeRate();
          updateConvertedAmount();
          window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
        } else {
          alert(data.error || 'ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (e) {
        console.error('ì‹ ì²­ ì˜¤ë¥˜:', e);
        alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
    coinTypeInput.addEventListener('change', updateExchangeRate);
    amountInput.addEventListener('input', updateConvertedAmount);
    document.getElementById('copy-wallet').addEventListener('click', async function() {
      const wallet = document.getElementById('wallet');
      try {
        if (navigator.clipboard) {
          await navigator.clipboard.writeText(wallet.value);
        } else {
          wallet.select();
          wallet.setSelectionRange(0, 99999);
          document.execCommand('copy');
        }
        this.textContent = 'ë³µì‚¬ë¨!';
        setTimeout(() => { this.textContent = 'ë³µì‚¬'; }, 1200);
      } catch {
        alert('ë³µì‚¬ ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
      }
    });
    depositorInput.addEventListener('input', function() {
      const val = this.value.trim();
      const list = getDepositorList().filter(x => x.includes(val) && x);
      let datalist = document.getElementById('depositor-list');
      if (!datalist) {
        datalist = document.createElement('datalist');
        datalist.id = 'depositor-list';
        this.setAttribute('list', 'depositor-list');
        document.body.appendChild(datalist);
      }
      datalist.innerHTML = list.map(x => `<option value="${x}">`).join('');
    });
    [depositorInput, amountInput, coinTypeInput, networkInput, walletInput].forEach(el => {
      el.addEventListener('input', saveTemp);
    });
    document.getElementById('lookup-btn').addEventListener('click', async function() {
      const depositor = document.getElementById('lookup-depositor').value.trim();
      const wallet = document.getElementById('lookup-wallet').value.trim();
      const resultDiv = document.getElementById('lookup-result');
      if (!depositor || !wallet) {
        resultDiv.innerHTML = '<span style="color:#e53935;">ì…ê¸ˆìëª…ê³¼ ì§€ê°‘ì£¼ì†Œë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.</span>';
        return;
      }
      resultDiv.innerHTML = 'ì¡°íšŒ ì¤‘...';
      try {
        const res = await fetch('http://localhost:3000/api/apply');
        const data = await res.json();
        const found = data.filter(x => x.depositor === depositor && x.wallet === wallet);
        if (!found.length) {
          resultDiv.innerHTML = '<span style="color:#e53935;">ì¼ì¹˜í•˜ëŠ” ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</span>';
        } else {
          resultDiv.innerHTML = found.map(x => `
            <div class="lookup-item" style="background:#fff; border-radius:10px; padding:16px 12px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.06);">
              <b>ì…ê¸ˆìëª…:</b> ${x.depositor}<br>
              <b>ê¸ˆì•¡:</b> ${parseFloat(x.amount).toLocaleString()} KRW<br>
              <b>ì½”ì¸:</b> ${x.coinType}<br>
              <b>ë„¤íŠ¸ì›Œí¬:</b> ${x.network}<br>
              <b>ì§€ê°‘ì£¼ì†Œ:</b> ${x.wallet}<br>
              <b>ì‹ ì²­ì¼ì‹œ:</b> ${new Date(x.createdAt).toLocaleString()}<br>
              <b>ìƒíƒœ:</b> <span style="font-weight:bold; color:${x.status==='ì™„ë£Œ'?'#388e3c':x.status==='ì²˜ë¦¬ì¤‘'?'#fbc02d':'#00796b'}">${x.status}</span>
              <br><button class="pdf-btn" style="margin-top:8px; padding:6px 14px; border-radius:7px; background:#1976d2; color:#fff; border:none; font-size:14px; cursor:pointer;">PDF ì €ì¥</button>
            </div>
          `).join('');
        }
      } catch {
        resultDiv.innerHTML = '<span style="color:#e53935;">ì„œë²„ ì˜¤ë¥˜. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</span>';
      }
    });
    document.getElementById('lookup-result').addEventListener('click', async function(e) {
      if (e.target && e.target.classList.contains('pdf-btn')) {
        const div = e.target.closest('.lookup-item');
        await downloadPDF(div);
      }
    });
    window.downloadPDF = async function(div) {
      const html2canvas = await import('https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/+esm');
      const jsPDF = await import('https://cdn.jsdelivr.net/npm/jspdf@2.5.1/+esm');
      const canvas = await html2canvas.default(div);
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF.default();
      const width = pdf.internal.pageSize.getWidth();
      const height = (canvas.height * width) / canvas.width;
      pdf.addImage(imgData, 'PNG', 0, 0, width, height);
      pdf.save('coin_apply.pdf');
    }
    networkInput.addEventListener('change', function() {
      let msg = '';
      if (this.value === 'TRC20') msg = 'TRC20(íŠ¸ë¡ ) ì§€ê°‘ì£¼ì†ŒëŠ” Të¡œ ì‹œì‘í•©ë‹ˆë‹¤.';
      if (this.value === 'ERC20') msg = 'ERC20(ì´ë”ë¦¬ì›€) ì§€ê°‘ì£¼ì†ŒëŠ” 0xë¡œ ì‹œì‘í•©ë‹ˆë‹¤.';
      if (this.value === 'BEP20') msg = 'BEP20(ë°”ì´ë‚¸ìŠ¤) ì§€ê°‘ì£¼ì†ŒëŠ” 0xë¡œ ì‹œì‘í•©ë‹ˆë‹¤.';
      let guide = document.getElementById('network-guide');
      if (!guide) {
        guide = document.createElement('div');
        guide.id = 'network-guide';
        guide.style = 'margin-top:6px; color:#1976d2; font-size:14px;';
        this.parentNode.appendChild(guide);
      }
      guide.textContent = msg;
    });
    document.getElementById('toggle-dark').addEventListener('click', function() {
      document.body.classList.toggle('dark');
      if (document.body.classList.contains('dark')) {
        this.textContent = 'â˜€ï¸';
        document.body.style.background = '#23272f';
        document.querySelector('.container').style.background = '#23272f';
        document.querySelector('.container').style.color = '#eee';
      } else {
        this.textContent = 'ğŸŒ™';
        document.body.style.background = '';
        document.querySelector('.container').style.background = '#fff';
        document.querySelector('.container').style.color = '';
      }
    });
    setInterval(fetchLiveApplyList, 5000);
    fetchLiveApplyList();
    loadTemp();
    updateExchangeRate();
    updateConvertedAmount();
  </script>
</body>
</html>
